<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaalQuest - A1 Dutch Listening Practice</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- API Key Setup Modal -->
    <div id="api-key-modal" class="modal">
        <div class="modal-content">
            <h2>Welcome to TaalQuest</h2>
            <p class="modal-description">
                Practice A1 Dutch through AI-generated dialogues.
                Enter your OpenAI API key to get started.
            </p>
            <div class="api-key-input-group">
                <label for="api-key-input">OpenAI API Key</label>
                <input type="password" id="api-key-input" placeholder="sk-..." autocomplete="off">
                <p class="api-key-hint">
                    <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener">Get your API key from OpenAI</a>
                </p>
            </div>
            <button id="save-api-key-button" class="primary-button">
                <span class="button-text">Start Learning</span>
            </button>
            <p id="api-key-error" class="error-message" style="display: none;"></p>
            <p class="api-key-note">
                Your API key is stored locally in your browser and never sent to any server except OpenAI.
            </p>
        </div>
    </div>

    <div class="game-container">
        <header>
            <h1>TaalQuest</h1>
            <p class="subtitle">A1 Dutch Listening Practice</p>
            <button id="settings-button" class="settings-button" title="Settings">
                <span class="settings-icon">&#9881;</span>
            </button>
        </header>

        <main id="game-screen">
            <div id="scenario-display">
                <div id="scene-image-container" class="scene-image-container" style="display: none;">
                    <img id="scene-image" class="scene-image" alt="Scene illustration">
                </div>
                <div class="scenario-icon" id="scenario-icon">&#127911;</div>
                <h2 id="scenario-title">Dutch Dialogue Practice</h2>
                <p id="scenario-situation" class="scenario-situation"></p>
            </div>

            <div id="status-area">
                <div id="current-speaker" class="current-speaker" style="display: none;">
                    <span class="speaker-label">Speaking:</span>
                    <span id="speaker-name" class="speaker-name"></span>
                </div>
                <p id="status-message"></p>
                <button id="generate-button" class="primary-button">
                    <span class="button-icon">&#10024;</span>
                    <span class="button-text">Generate New Dialogue</span>
                </button>
                <button id="play-button" class="primary-button" style="display: none;">
                    <span class="button-icon">&#9654;</span>
                    <span class="button-text">Play</span>
                </button>
            </div>

            <div id="transcript-controls" style="display: none;">
                <button id="show-transcript-button" class="transcript-toggle">
                    Show Transcript
                </button>
            </div>

            <div id="transcript" class="transcript-box" style="display: none;">
                <div class="transcript-header">
                    <h4 class="transcript-title dutch-title">Nederlands</h4>
                    <h4 class="transcript-title english-title">English</h4>
                </div>
                <div id="transcript-content"></div>
            </div>

            <div id="quiz-section" style="display: none;">
                <div class="quiz-header">
                    <h3>Test Your Understanding</h3>
                    <p id="quiz-progress">Question 1 of 3</p>
                </div>
                <div id="quiz-content">
                    <p id="quiz-question" class="quiz-question"></p>
                    <div id="quiz-options" class="quiz-options"></div>
                    <div id="quiz-feedback" class="quiz-feedback" style="display: none;"></div>
                    <button id="quiz-next-button" class="primary-button" style="display: none;">
                        Next Question
                    </button>
                </div>
                <div id="quiz-results" style="display: none;">
                    <h3 id="quiz-score"></h3>
                    <p id="quiz-message"></p>
                </div>
            </div>

            <div id="controls" style="display: none;">
                <button id="replay-button" class="secondary-button" disabled>
                    <span class="button-icon">&#8635;</span>
                    <span class="button-text">Replay</span>
                </button>
                <button id="new-dialogue-button" class="secondary-button" disabled>
                    <span class="button-icon">&#10024;</span>
                    <span class="button-text">New Dialogue</span>
                </button>
            </div>
        </main>

        <footer>
            <p class="footer-text">Powered by OpenAI</p>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Settings</h2>
            <div class="api-key-input-group">
                <label for="settings-api-key-input">OpenAI API Key</label>
                <input type="password" id="settings-api-key-input" placeholder="sk-..." autocomplete="off">
            </div>
            <div class="modal-buttons">
                <button id="update-api-key-button" class="primary-button">
                    <span class="button-text">Update Key</span>
                </button>
                <button id="clear-api-key-button" class="secondary-button danger">
                    <span class="button-text">Clear Key</span>
                </button>
                <button id="close-settings-button" class="secondary-button">
                    <span class="button-text">Close</span>
                </button>
            </div>
            <p id="settings-error" class="error-message" style="display: none;"></p>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
